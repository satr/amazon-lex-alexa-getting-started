plugins {
    id 'java'
}

group 'io.github.satr'
version '1.0-Stage-6'

sourceCompatibility = 11.0

repositories {
    mavenCentral()
    maven {
        url 'http://dynamodb-local.s3-website-us-west-2.amazonaws.com/release'
    }
}

configurations {
    dynamodb
}

dependencies {
    testCompile group: 'junit', name: 'junit', version: '4.13'
    testCompile "org.mockito:mockito-all:1.10.19"
    testImplementation 'com.amazonaws:DynamoDBLocal:1.16.0'
    dynamodb fileTree (dir: 'lib', include: ["*.dylib", "*.so", "*.dll"])
    dynamodb "com.amazonaws:DynamoDBLocal:1.16.0"
    compile "com.amazonaws:aws-lambda-java-core:1.2.1"
    compile "com.amazonaws:aws-java-sdk-lambda:1.12.220"
    compile "com.amazonaws:aws-java-sdk-dynamodb:1.12.220"
    compile group: 'com.amazon.alexa', name: 'ask-sdk', version:'2.43.5'
    compile group: 'com.amazonaws', name: 'aws-lambda-java-log4j2', version:'1.5.1'
}

jar {
    from {
        configurations.compile.collect { it.isDirectory() ? it : zipTree(it) }
    }
}

task copyNativeDeps(type: Copy) {
    from configurations.dynamodb
    into "$project.buildDir/libs/"
}

test.dependsOn copyNativeDeps
test.doFirst {
    systemProperty "java.library.path", 'build/libs'
}